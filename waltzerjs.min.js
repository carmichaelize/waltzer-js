/*
*
* Project: WaltzerJS
* URL: http://www.waltzer-js.co.uk
* Author: Scott Carmichael
* Version: 1.1
*
* Copyright (c) 2014 Scott Carmichael
* Dual Licensed under GPL(http://www.gnu.org/licenses/gpl.html) & MIT (http://www.opensource.org/licenses/mit-license.php)
*
*/

;(function(e,t,n,r){e.fn.waltzer=function(t){function s(t,r){this.options=e.extend({},n,r);this.coreValues(t);this.utilities(this);this.actions(this);this.init(this)}var n={developerMode:false,vertical:false,scroll:1,offset:0,circular:true,auto:false,autoPause:1e3,speed:300,easing:"swing",navBtns:true,leftNavBtn:"left-nav-btn",rightNavBtn:"right-nav-btn",pager:false,onCreate:null,onComplete:null,onForwardComplete:null,onBackwardComplete:null};s.prototype.coreValues=function(t){this.$container=t;this.$items=this.$container.children().not("."+this.options.leftNavBtn+", ."+this.options.rightNavBtn);if(this.options.navBtns){e('<div class="'+this.options.leftNavBtn+'"></div>').appendTo(this.$container);e('<div class="'+this.options.rightNavBtn+'"></div>').appendTo(this.$container);this.$buttons=this.$container.find("."+this.options.leftNavBtn+", ."+this.options.rightNavBtn)}this.itemCount=this.$items.length;if(this.options.vertical){this.containerWidth=this.$container.outerHeight(false);this.itemWidth=this.$items.outerHeight(true);this.itemMarginWidth=this.itemWidth-this.$items.outerHeight(false);this.containerHeight=this.containerWidth}else{this.containerWidth=this.$container.outerWidth(false);this.itemWidth=this.$items.outerWidth(true);this.itemMarginWidth=this.itemWidth-this.$items.outerWidth(false);this.containerHeight=this.$items.outerHeight(false)}this.innerWrapperWidth=this.itemWidth*this.itemCount;this.innerWrapperPos=0;this.speed=this.options.scroll*this.options.speed;this.scrollWidth=this.itemWidth*this.options.scroll;this.pageCount=1;this.options.circular=this.options.pager?false:this.options.circular;if(this.itemCount%this.options.scroll!=0||this.containerWidth/this.itemWidth+1<this.options.scroll){for(i=this.options.scroll-1;i>=1;i--){if(this.itemCount%i==0&&this.containerWidth/this.itemWidth+1>i){this.options.scroll=i;break}}}};s.prototype.utilities=function(e){this.cutAndPaste=function(e){if(e=="forward"){for(i=0;i<this.options.scroll;i++){this.innerWrapper.append(this.$items[i])}}else if(e=="backward"){for(i=this.itemCount;i>=this.itemCount-this.options.scroll;i--){this.innerWrapper.prepend(this.$items[i])}}};this.refreshItemList=function(){return this.$items=this.innerWrapper.children("div.item")};this.updatePageCount=function(e,t){t=t==r||t==false?1:t;for(i=0;i<t;i++){if(e=="forward"){if(this.pageCount<this.itemCount/this.options.scroll){this.pageCount++}else{this.pageCount=1}}else if(e="backward"){if(this.pageCount>1){this.pageCount--}else{this.pageCount=this.itemCount/this.options.scroll}}}if(this.options.pager){this.$container.find(".pager").children("span").removeClass("active");this.$container.find(".pager").children("span[data-button ="+this.pageCount+"]").addClass("active")}};this.addAuto=function(){if(this.options.auto){return setInterval(function(){e.move("forward")},this.options.autoPause)}return false};this.removeAuto=function(){return this.options.auto?clearInterval(e.autoScroll):false};this.eventTrigger=function(t){if(typeof t=="string"){e.$container.trigger(t)}else{for(i=0;i<t.length;i++){e.$container.trigger(t[i])}}};this.animateFunction=function(t,n,r){this.innerWrapper.animate(t,this.speed,this.easing,function(){e.updatePageCount(n,r);e.directionCallBack.resolve(n);e.completeCallBack.resolve("completed");e.eventTrigger([n+"Complete","moved"])})}};s.prototype.actions=function(t){this.animate=function(t,n){if(this.innerWrapper.is(":animated")){return false}var i={},s=this.options.vertical==true?"top":"left",n=n==r||n==false?1:n,o=this.scrollWidth*n;this.directionCallBack=e.Deferred();this.completeCallBack=e.Deferred();i[s]=t=="forward"?"-="+o:"+="+o;this.eventTrigger(t);if(t=="forward"){if(this.innerWrapperWidth+this.innerWrapperPos[s]>this.containerWidth+this.itemWidth){this.animateFunction(i,t,n)}else if(this.options.circular){this.cutAndPaste("forward");this.innerWrapper.css(s,this.innerWrapperPos[s]+this.scrollWidth);this.animateFunction(i,t,n);this.refreshItemList()}else if(!this.options.circular){i[s]=0;this.animateFunction(i,t,n)}}else if(t=="backward"){if(this.innerWrapperPos[s]<0){this.animateFunction(i,t,n)}else if(this.options.circular){this.cutAndPaste("backward");this.innerWrapper.css(s,this.innerWrapperPos[s]-this.scrollWidth);this.animateFunction(i,t,n);this.refreshItemList()}else if(!this.options.circular){if(this.scrollWidth<this.containerWidth){var u=this.containerWidth;while(u>0){u-=this.itemWidth}i[s]=(this.innerWrapperWidth-this.containerWidth+u)*-1}else{i[s]=(this.innerWrapperWidth-this.scrollWidth)*-1}this.animateFunction(i,t,n)}}this.initCallBacks(this.directionCallBack,this.completeCallBack)},this.initCallBacks=function(e,n){if(t.options.onForwardComplete||t.options.onBackwardComplete){e.done(function(e){if(e=="forward"){if(typeof t.options.onForwardComplete=="function"){t.options.onForwardComplete.call(t)}}else if(e=="backward"){if(typeof t.options.onBackwardComplete=="function"){t.options.onBackwardComplete.call(t)}}})}if(typeof t.options.onComplete=="function"){n.done(function(e){t.options.onComplete.call(t)})}}};s.prototype.init=function(t){if(this.options.vertical){this.$items.wrapAll('<div class="innerWrapper" style="position:relative; height:'+this.innerWrapperWidth+'px;"></div>')}else{this.$items.wrapAll('<div class="innerWrapper" style="position:relative; width:'+this.innerWrapperWidth+'px;"></div>')}this.innerWrapper=this.$container.children("div.innerWrapper");this.innerWrapper.wrap('<div class="mask" style="position:relative; overflow:hidden; width:100%; height:'+this.containerHeight+'px;"></div>');if(this.options.offset!=0){for(i=0;i<this.options.offset;i++){this.innerWrapper.append(this.$items[i])}this.refreshItemList()}if(this.options.onCreate&&typeof this.options.onCreate=="function"){this.options.onCreate.call(this)}if(this.options.pager){this.$container.append('<div class="pager"></div>');var n=this.itemCount/this.options.scroll;for(i=0;i<n;i++){var r=this.pageCount==i+1?"active":"";this.$container.find(".pager").append('<span class="'+r+'" data-button="'+(i+1)+'"><span>'+(i+1)+"</span></span>")}this.$container.on("click",".pager > span",function(){var n=t.pageCount,r=e(this).attr("data-button");if(n<r||n>r){if(n<r){t.move("forward",r-n)}else{t.move("backward",(r-n)*-1)}}})}if(this.options.auto){this.autoScroll=this.addAuto()}if(this.options.developerMode){console.log(this)}if(this.options.navBtns){this.$buttons.on("click",function(){if(e(this).attr("class")==t.options.leftNavBtn){t.move("backward")}else if(e(this).attr("class")==t.options.rightNavBtn){t.move("forward")}})}if(this.options.auto){this.$container.on({mouseover:function(){return t.removeAuto()},mouseout:function(){return t.autoScroll=t.addAuto()}})}};s.prototype.destroy=function(e){this.$container.find(".mask").after(this.$items).remove();if(this.options.navBtns){this.$buttons.off()}};s.prototype.move=function(e,t){this.innerWrapperPos=this.innerWrapper.position();this.animate(e,t)};this.each(function(){if(typeof t==="string"){$this=e(this).data("plugin_waltzerJS");if(t=="forward"||t=="backward"){$this.move.call($this,t)}else if(t=="stop"){$this.removeAuto()}else if(t=="start"){$this.autoScroll=$this.addAuto()}else if(t=="destroy"){$this[t].call($this)}}else if(!e.data(e(this),"plugin_waltzerJS")){e(this).data("plugin_waltzerJS",new s(e(this),t))}});return this}})(jQuery,window,document);